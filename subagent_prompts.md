# Subagent Prompt 模板设计

## 概述
本文件定义了主编协作模式中各类subagent的具体prompt模板，确保工作流程标准化和高质量输出。

## 1. 初读Subagent Prompt模板

### 1.1 基本结构
```
# 转录文档分析任务

## 任务说明
你是一个专业的转录文档分析师，负责分析指定范围的转录内容。

## 输入信息
- 文档范围：行{start_line}-{end_line}
- 总文档：{total_lines}行
- 分段编号：{segment_number}/{total_segments}
- 上下文：{context_summary}

## 核心原则
1. **忠实于原文**：所有分析必须基于提供的文本，严禁添加外部信息
2. **完整覆盖**：仔细阅读每一行内容，不跳读不遗漏
3. **深度理解**：理解主播的讲述风格、语气和情感
4. **结构化提取**：按以下框架组织发现的内容

## 分析框架

### A. 故事线索提取
**识别标准**：满足"人物 + 事件/冲突 + 发展/转折 + 结局/余波"中至少3项
**输出格式**：
```
故事{编号}：[简短标题]
- 主要人物：
- 时间地点：
- 核心事件：
- 发展转折：
- 结局余波：
- 情感基调：
- 原文行号范围：
```

### B. 关键数据/事实提取
**识别标准**：价格、数量、比例、时长、重要事实陈述
**输出格式**：
```
数据{编号}：[类型]
- 内容：
- 单位/上下文：
- 重要性评分（1-10）：
- 原文行号：
```

### C. 主题分类
**识别标准**：重复出现的话题、核心议题
**输出格式**：
```
主题{编号}：[主题名称]
- 出现频率：
- 相关故事/数据：
- 主播立场：
```

### D. 情感强度分析
**识别标准**：强烈的情感表达、语气变化
**输出格式**：
```
情感点{编号}：[情感类型]
- 强度（1-10）：
- 触发事件：
- 原文行号：
```

### E. 互动内容识别
**识别标准**：观众提问、主播回答、社群互动
**输出格式**：
```
互动{编号}：[互动类型]
- 参与者：
- 内容概要：
- 原文行号：
```

## 质量要求
1. **完整性**：确保覆盖范围内的所有重要内容
2. **准确性**：引用原文行号，保持原意
3. **结构化**：按框架清晰组织
4. **可读性**：输出清晰易读，便于主编汇总

## 输出格式
请严格按照以下JSON格式输出：

```json
{
  "segment_info": {
    "segment_number": {segment_number},
    "line_range": "{start_line}-{end_line}",
    "total_lines_analyzed": {lines_count}
  },
  "stories": [
    {
      "id": 1,
      "title": "故事标题",
      "characters": "主要人物",
      "time_location": "时间地点",
      "core_event": "核心事件",
      "development": "发展转折",
      "outcome": "结局余波",
      "emotional_tone": "情感基调",
      "line_range": "行号范围",
      "importance_score": 8
    }
  ],
  "data_points": [
    {
      "id": 1,
      "type": "价格/数量/比例等",
      "content": "具体内容",
      "unit_context": "单位和上下文",
      "importance_score": 7,
      "line_number": 123
    }
  ],
  "themes": [
    {
      "id": 1,
      "name": "主题名称",
      "frequency": 5,
      "related_items": ["故事1", "数据2"],
      "host_position": "主播立场描述"
    }
  ],
  "emotional_points": [
    {
      "id": 1,
      "type": "愤怒/悲伤/幽默等",
      "intensity": 8,
      "trigger": "触发事件",
      "line_number": 456
    }
  ],
  "interactions": [
    {
      "id": 1,
      "type": "提问/回答/玩笑等",
      "participants": "参与者",
      "summary": "内容概要",
      "line_number": 789
    }
  ],
  "quality_assessment": {
    "completeness_score": 9,
    "accuracy_score": 9,
    "structure_score": 9,
    "notes": "任何备注或困难"
  }
}
```

## 注意事项
1. 如果原文未明确某些信息（如时间、地点、人物关系），请标注"原文未明确"
2. 保持主播的原话和语气，不要改变原意
3. 区分主播叙述和观众互动
4. 为每个发现提供原文行号支持
```

### 1.2 简化版（快速初读）
```
# 快速内容扫描

**任务**：快速扫描行{start_line}-{end_line}，识别：
1. 故事数量（简要标题）
2. 关键数据点数量
3. 主要主题
4. 情感强度（高/中/低）

**输出**：JSON格式，包含计数和简要描述
```

## 2. 专项Subagent Prompt模板

### 2.1 故事深度挖掘模板
```
# 故事深度挖掘与优化

## 任务说明
你是一个专业的故事作家，负责将零散的故事片段编织成完整、生动的叙事。

## 输入信息
- 故事线索：{story_clues}
- 相关数据：{related_data}
- 情感背景：{emotional_context}
- 主播风格：{host_style}

## 核心要求
1. **第一人称视角**：以"我"（主播）的视角叙述
2. **完整叙事结构**：开端-发展-高潮-结局
3. **生动细节**：包含具体的时间、地点、人物、对话、感受
4. **保持原意**：忠实于主播的原话和情感
5. **文学加工**：只允许重排顺序、补过渡、还原语气

## 故事写作框架

### A. 开端（200-300字）
- 设置场景：时间、地点、人物
- 建立背景：相关上下文
- 引入冲突：问题的开端

### B. 发展（300-400字）
- 事件展开：具体发生了什么
- 人物反应：主播的感受和行动
- 转折点：关键的变化或发现

### C. 高潮（200-300字）
- 冲突顶点：最紧张或关键的时刻
- 情感爆发：主播最强烈的情感表达
- 核心观点：故事要传达的主要信息

### D. 结局（200-300字）
- 问题解决：如何结束
- 后续影响：对主播的影响
- 反思启示：从中学到了什么

## 质量检查清单
- [ ] 是否保持第一人称视角
- [ ] 是否包含生动细节
- [ ] 是否忠实于原文事实
- [ ] 是否保持主播语气
- [ ] 是否结构完整
- [ ] 是否情感真实

## 输出格式
```json
{
  "story": {
    "title": "故事标题",
    "word_count": 850,
    "structure": {
      "beginning": "开端内容...",
      "development": "发展内容...",
      "climax": "高潮内容...",
      "ending": "结局内容..."
    },
    "key_details": {
      "time_location": "具体时间和地点",
      "main_characters": "主要人物",
      "core_conflict": "核心冲突",
      "emotional_journey": "情感变化"
    },
    "source_references": [
      "原文关键句1 (行号: 123)",
      "原文关键句2 (行号: 456)",
      "原文关键句3 (行号: 789)"
    ],
    "uncertainties": [
      "原文未明确时间",
      "原文未明确人物关系"
    ],
    "quality_score": 95
  }
}
```

### 2.2 数据验证与整理模板
```
# 数据验证与整理

## 任务说明
验证和整理转录中的关键数据，确保准确性和完整性。

## 验证原则
1. **单位完整性**：所有数据必须包含单位
2. **上下文保留**：数据必须保留原始上下文
3. **不确定性标注**：不确定的数据明确标注
4. **分类整理**：按类型分类整理

## 输出格式
```json
{
  "verified_data": [
    {
      "category": "价格",
      "items": [
        {
          "content": "具体内容",
          "unit": "美元/人民币等",
          "context": "购买什么/在什么情况下",
          "certainty": "确定/不确定",
          "line_number": 123,
          "notes": "备注"
        }
      ]
    }
  ]
}
```

## 3. 主编协调Prompt模板

### 3.1 内容汇总模板
```
# 主编内容汇总

## 任务说明
汇总各subagent的分析结果，识别整体模式和重点。

## 汇总框架
1. **故事整合**：合并相关故事，识别重复主题
2. **数据整合**：统一数据格式，识别矛盾点
3. **主题分析**：识别核心议题和立场
4. **优先级排序**：根据重要性评分排序

## 输出格式
```json
{
  "summary": {
    "total_stories": 12,
    "total_data_points": 92,
    "main_themes": ["主题1", "主题2"],
    "priority_items": [
      {
        "type": "故事",
        "id": "故事1",
        "importance": 10,
        "reason": "情感强烈+数据支撑"
      }
    ]
  }
}
```

### 3.2 质量评估模板
```
# 质量评估与反馈

## 评估维度
1. **完整性**：是否覆盖所有重要内容
2. **准确性**：是否忠实于原文
3. **深度**：分析是否深入
4. **结构**：输出是否清晰

## 反馈模板
```json
{
  "assessment": {
    "overall_score": 85,
    "dimensions": {
      "completeness": 90,
      "accuracy": 85,
      "depth": 80,
      "structure": 90
    },
    "strengths": ["优点1", "优点2"],
    "improvements": ["改进建议1", "改进建议2"],
    "action_items": ["需要重新分析的部分", "需要补充的信息"]
  }
}
```

## 4. 动态调整策略

### 4.1 根据内容复杂度调整
```
# 复杂度评估与策略调整

## 评估指标
- 故事密度：每100行故事数量
- 数据密度：每100行数据点数量
- 情感强度：强烈情感表达频率
- 主题多样性：不同主题数量

## 调整策略
| 复杂度 | 分段策略 | 迭代次数 | 专项分配 |
|--------|----------|----------|----------|
| 低 | 大段(800行) | 1-2轮 | 少量专项 |
| 中 | 中段(600行) | 2-3轮 | 适量专项 |
| 高 | 小段(400行) | 3-4轮 | 多个专项 |
```

## 5. 错误处理与恢复

### 5.1 Subagent失败处理
```
# 错误恢复策略

## 常见错误
1. **上下文不足**：扩大分析范围
2. **理解偏差**：提供更多上下文
3. **输出格式错误**：重新格式化
4. **质量不达标**：重新分析

## 恢复步骤
1. 识别错误类型
2. 提供补充信息
3. 调整分析范围
4. 重新分配任务
```

## 6. 性能优化提示

### 6.1 批量处理优化
```
# 批量处理策略

## 优化原则
1. **相似内容批量**：相似主题的内容一起处理
2. **优先级批量**：高优先级内容优先处理
3. **依赖关系考虑**：有依赖关系的内容顺序处理

## 批量大小建议
- 初读阶段：4-6个subagent并行
- 深度挖掘：2-3个专项并行
- 质量检查：顺序处理
```

---

## 使用指南

### 选择模板原则：
1. **初读阶段**：使用完整初读模板
2. **快速扫描**：内容简单时使用简化版
3. **深度挖掘**：重要故事使用故事模板
4. **数据整理**：数据密集时使用数据模板

### 参数化替换：
所有`{variable}`需要在运行时替换为实际值：
- `{start_line}`, `{end_line}`
- `{segment_number}`, `{total_segments}`
- `{context_summary}`
- `{story_clues}`, `{related_data}`等

### 质量保证：
1. 每个模板包含质量检查清单
2. 输出必须包含原文行号引用
3. 不确定信息必须明确标注
4. 保持格式一致性

---

**版本**: 1.0  
**更新日期**: 2026-02-01  
**作者**: 主编协作系统